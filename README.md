# Overflow 标注平台

一个用于浏览海量钻井时序数据图表、通过输入坐标范围完成“溢流 / 漏失”标注并导出结果的 Web 应用。

## 功能概览

- 启动时自动扫描 `csv/` 目录下的 `Rec*.csv` 文件，按时间排序。
- 为每个 CSV 文件生成轻量化预览图并缓存到 `charts/`。
- 提供基于表单的事件标注：跨文件范围、事件类型校验与行号校验。
- 支持事件查询 / 删除、并将标注结果导出到 `marked/` 目录。

## 快速开始

```powershell
uv sync
uv run uvicorn server:app --reload --host 0.0.0.0 --port 8001
```

打开浏览器访问 <http://localhost:8001> 即可进入标注界面。

> **提示**：首次启动会对全部 CSV 生成图像，数据量较大时需要一定时间。

## 导出规则

- 事件可以跨越多个文件；起始文件以内从起始行到文件末尾，结束文件以内从文件开头到结束行，中间文件则全量纳入。
- 一行可以同时属于多个事件；导出的 CSV 会包含 `overflow`、`lost` 两列，按所属事件置 0/1。
- 导出的文件保存为 `marked/RecXXXXXXXXXX_annotated.csv`。

## 运行测试

```powershell
uv run pytest
```

## 目录说明

- `server.py`：FastAPI 后端入口。
- `app/`：数据加载、图表生成、事件管理等核心逻辑。
- `templates/`、`static/`：前端页面与样式。
- `charts/`、`marked/`：运行时生成的图像与标注结果。

## 常见问题

- **生成图表报错**：请确认 CSV 文件编码（默认尝试 `gbk` → `utf-8` → `utf-8-sig`）。
- **导出为空**：请检查事件范围是否覆盖有效行号；导出仅包含至少匹配一个事件的行。
